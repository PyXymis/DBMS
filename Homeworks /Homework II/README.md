# Homework II [Done]
* **[Homeworks](/README.md)** - *Все домашние задания*
# Assigment
## Домашнее задание
### Добавляем в модель данных дополнительные индексы и ограничения

**Цель:**<br>
* *Научиться применять индексы в реальном проекте*

Описание/Пошаговая инструкция выполнения домашнего задания:
* Проводим анализ возможных запросов\отчетов\поиска данных.
* Предполагаем возможную кардинальность поля.
* Создаем дополнительные индексы - простые или композитные.
На каждый индекс пишем краткое описание зачем он нужен (почему по этому полю\полям).
* Думаем какие логические ограничения в БД нужно добавить - например какие поля должны быть уникальны, в какие нужно добавить условия, чтобы не нарушить бизнес логику. <br>
*Пример - нельзя провести операцию по переводу средств на отрицательную сумму.*
* Создаем ограничения по выбранным полям.

***Критерии оценки:***
* Выполнение ДЗ: 10 баллов
* плюс 2 балла за красивое решение
* минус 2 балла за рабочее решение, и недостатки указанные преподавателем не устранены
# Assessment
![image](https://user-images.githubusercontent.com/37443340/227890091-022abddf-40b5-4b30-9026-981c53cc046d.png)

# Solution
## Анализ возможных запросов
- От бекенда мы часто будем взаимодействовать с основными сущностями - Аккаунт и Заказ, поэтому имеет смысл обвешивать индексами таблицы которые будет запрашивать пользователь
  - Например, для повышения отображения истории заказов было бы оптимально дополнить индексом таблицу order_item по индексу к orders, чтобы к каждому заказу быстро находить все продукты 
- От маркетинга мы можем ожидать запросы на то, сколько клиентов подключилось к приложению и сколько заказов было выполненно за какой-то период времени, поэтому было бы хорошо раширить соответствующие таблицы полем created_date DateField. Также маркетинг может запрашивать сводку по заказам в определенных ценовых диапазонах + идея для индекса
- От менеджеров мы ожидаем частые запросы на получение и обновление товаров в категориях, поэтому одним из возможных индексов является - isActive. Кол-во товаров на складе - важный показатель для отслеживания, вторая идея - stock

## Предполагаем возможную кардинальность поля.
*Не уверен насчет вычисляемости кардинальности поля, понимаю что у Boolean низкая кардинальность, а у string может быть очень высокая*

У вышеперечисленных полей, которые я планирую использовать для индексов кардинальность может быть следующая:
- order_item - имеет среднюю кардинальность: кол-во проданных позиций / кол-во заказов
- created_date - кардинальность средняя: сколько пользователей регистрируется каждый день
- created + price - имеет высокую кардинальность, так как created DatetimeAutoNow field
- stock - имеет среднюю кардинальность так как Integer
- isActive - низкая кардинальность, Boolean Field 

## Создаем дополнительные индексы - простые или композитные.

    # psql
    CREATE INDEX idx_order_id ON order_item (order_id);
    CREATE INDEX idx_created_date ON accounts (created_date);
    CREATE INDEX idx_created_price ON orders (created_date, price);
    CREATE INDEX idx_stock ON product (stock);
    CREATE INDEX idx_isactive ON product (isActive);

## На каждый индекс пишем краткое описание зачем он нужен (почему по этому полю\полям).
Ответ на вопрос дан выше 

## Думаем какие логические ограничения в БД нужно добавить 

У нас точно не могут быть отрицательные значения для цены, кол-ва. Цена скидки не может быть больше, чем цена заказа, а возраст пользователя вряд ли будет больше 80+ лет

## Создаем ограничения по выбранным полям

    # psql 
    ALTER TABLE ordsers ADD CONSTRAINT check_total CHECK (total_price >= discount AND total_price >= 0);
    ALTER TABLE accounts ADD CONSTRAINT check_birthday CHECK (extract(year from birthday) >= 1960);

